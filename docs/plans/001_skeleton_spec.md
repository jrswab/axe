# Specification: M1 - Skeleton CLI Implementation

**Status:** Draft  
**Version:** 1.0  
**Created:** 2026-02-26  
**Scope:** Initialize the Axe CLI project with basic command infrastructure

---

## 1. Purpose

Create the foundational CLI infrastructure for Axe. This milestone establishes the project structure, dependency management, and essential commands required for subsequent milestones. The goal is to produce a functional binary with configuration scaffolding capabilities.

---

## 2. Requirements

### 2.1 Project Initialization

**Requirement 1.1:** Initialize a Go module named `github.com/jrswab/axe`.

**Requirement 1.2:** Project must follow standard Go project layout:
```
axe/
├── cmd/
│   ├── root.go
│   ├── version.go
│   └── config.go
├── internal/
│   └── xdg/
│       └── xdg.go
├── skills/
│   └── sample/
│       └── SKILL.md
├── go.mod
├── go.sum
└── main.go
```

**Requirement 1.3:** Use Cobra CLI framework (`github.com/spf13/cobra`) as the sole external dependency for command handling.

### 2.2 XDG Directory Management

**Requirement 2.1:** Implement XDG Base Directory specification compliance using Go standard library `os.UserConfigDir()`.

**Requirement 2.2:** Configuration directory path must resolve to `$XDG_CONFIG_HOME/axe` where:
- If `XDG_CONFIG_HOME` environment variable is set, use its value
- If not set, use `os.UserConfigDir()` return value + `/axe`
- Path separators must be OS-appropriate (backslash on Windows, forward slash elsewhere)

**Requirement 2.3:** Path resolution must be deterministic and cacheable within a single process execution.

### 2.3 Version Command

**Requirement 3.1:** Command `axe version` must exist and print version information to stdout.

**Requirement 3.2:** Output format must be exactly: `axe version 0.1.0`

**Requirement 3.3:** Version must be hardcoded as a constant in the source code, not injected at build time.

**Requirement 3.4:** Exit code must be 0 on success.

### 2.4 Help Command

**Requirement 4.1:** Command `axe help` (or `axe --help`, `-h`) must display usage information.

**Requirement 4.2:** Help output must include:
- Brief description of the tool
- List of available top-level commands
- Available global flags
- Usage examples

**Requirement 4.3:** Help must be auto-generated by the CLI framework (Cobra).

### 2.5 Config Path Command

**Requirement 5.1:** Command `axe config path` must print the full path to the XDG configuration directory.

**Requirement 5.2:** Output format must be:
- Full absolute path (resolved)
- Single line
- No trailing newline characters other than the system default
- No additional text, prefixes, or formatting

**Requirement 5.3:** Edge Cases:
- If the directory does not exist yet, the command must still print the expected path (the directory is not created)
- If environment variable `XDG_CONFIG_HOME` is unset, use the platform default (per `os.UserConfigDir()`)
- Must handle all supported platforms: Linux, macOS, Windows

### 2.6 Config Init Command

**Requirement 6.1:** Command `axe config init` must create the configuration directory structure at the XDG config path.

**Requirement 6.2:** Directory structure to be created:
```
$XDG_CONFIG_HOME/axe/
├── agents/
└── skills/
    └── sample/
        └── SKILL.md
```

**Requirement 6.3:** The `SKILL.md` file must be copied from the project's embedded `skills/sample/SKILL.md` asset.

**Requirement 6.4:** Idempotency:
- If directories already exist, command must complete silently (no error)
- If files already exist, they must not be overwritten (silent success)
- If parent directories do not exist, they must be created recursively
- All created directories must have appropriate permissions (readable/writable by owner)

**Requirement 6.5:** Output:
- On success: Print the path to the created/verified configuration directory (same format as `axe config path`)
- Exit code: 0

**Requirement 6.6:** Error Handling:
- If directory creation fails due to permissions, return exit code 1 and error message to stderr
- If file copy fails, return exit code 1 and error message to stderr

### 2.7 Sample Skill Template

**Requirement 7.1:** A sample SKILL.md template must exist at `skills/sample/SKILL.md` in the source tree.

**Requirement 7.2:** The template must contain:
- Skill name/title header
- Purpose section describing the skill's function
- Instructions section with guidance
- Output format section defining expected structure

**Requirement 7.3:** The template serves as documentation for future skill authors and is copied to user config during `axe config init`.

### 2.8 Exit Codes

**Requirement 8.1:** All commands must follow standard exit code conventions:
- 0: Success
- 1: General error (command execution failure, I/O errors, etc.)

**Requirement 8.2:** Exit codes must be returned to the calling process shell.

---

## 3. Constraints

**Constraint 1:** No additional external dependencies beyond Cobra. Use Go standard library for all functionality.

**Constraint 2:** Hardcoded version constant. No build-time injection or runtime version detection.

**Constraint 3:** Silent success behavior for `config init` when directories/files exist. No warnings messages on idempotent operations.

**Constraint 4:** Cross-platform compatibility: must build and run on Linux, macOS, and Windows.

**Constraint 5:** No configuration file parsing yet (deferred to M2).

---

## 4. Acceptance Criteria

| Criterion | Test |
|-----------|------|
| Build Success | `go build` produces a functional binary without errors |
| Version Command | `axe version` outputs exactly `axe version 0.1.0` with exit code 0 |
| Help Command | `axe help` displays command list and usage examples |
| Config Path | `axe config path` prints valid XDG path for the platform |
| Config Init - New | `axe config init` creates `agents/` and `skills/sample/SKILL.md` |
| Config Init - Existing | Running `axe config init` twice succeeds silently both times |
| Directory Structure | `ls $XDG_CONFIG_HOME/axe/` shows `agents/` and `skills/` directories |
| Sample Skill | `cat $XDG_CONFIG_HOME/axe/skills/sample/SKILL.md` shows valid template |
| Permissions | Created directories are readable/writable by the owner |
| Exit Codes | All commands return appropriate exit codes (0 for success, 1 for error) |

---

## 5. Out of Scope

The following items are explicitly **not** included in M1:

1. TOML configuration parsing (M2)
2. Agent configuration loading (M2)
3. LLM provider integration (M3)
4. File glob resolution (M3)
5. Sub-agent functionality (M5)
6. Memory system (M6)
7. Garbage collection (M7)
8. Environment variable configuration
9. Configuration file validation
10. Interactive prompts or TUI

---

## 6. References

- Planning Document: `docs/milestones.md` (M1 section)
- CLI Structure: `docs/cli-structure.md`
- Agent Config Schema: `docs/agent-config-schema.md`
- XDG Base Directory Specification: https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
- Cobra Documentation: https://github.com/spf13/cobra

---

## 7. Notes

- The `agents/` directory is created empty in M1. Agent TOML files will be created manually by users or via future `axe agents init` command (M2).
- The `skills/sample/SKILL.md` serves as both a template and documentation example.
- Cross-platform testing must verify that XDG paths resolve correctly on Windows (uses `%LOCALAPPDATA%` or similar).
- Future milestones (M2+) will build upon this foundation without modifying the established directory structure.
